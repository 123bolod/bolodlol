<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡¶¶‡¶æ‡¶â‡¶¶ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‚Äî Daud Store</title>
  <meta name="description" content="‡¶¶‡¶æ‡¶â‡¶¶ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ - single-file responsive e-commerce (admin upload, feedback with product image, pagination).">
  <style>
    :root{ --bg:#f8fafc; --card:#fff; --muted:#6b7280; --accent:#ff7a00; --accent-2:#ff9a33; --shadow:0 10px 30px rgba(2,6,23,0.06); --radius:12px; --btn-shadow: rgba(255,122,0,.45);}
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;font-family:Inter,system-ui,Arial;color:#0f172a;background:var(--bg);-webkit-font-smoothing:antialiased}
    .topbar{position:sticky;top:0;z-index:120;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 6px 20px rgba(0,0,0,0.08)}
    .brand-left{display:flex;align-items:center;gap:12px}
    #siteLogo{width:52px;height:52px;border-radius:10px;background:#fff;padding:6px;object-fit:contain;box-shadow:var(--shadow)}
    .brand-title{font-weight:800;font-size:1.05rem}.brand-sub{font-size:12px;opacity:.95}
    .nav{display:flex;gap:12px;align-items:center}
    .nav a{font-weight:700;color:rgba(255,255,255,0.95);padding:8px 10px;border-radius:8px}
    .top-actions{display:flex;gap:8px;align-items:center}

    /* Base buttons */
    .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:#fff;color:var(--accent)}
    .btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.12)} .btn.small{padding:6px 8px;font-size:.9rem}
    .btn.primary{background:var(--accent);color:#fff}
    .pill{padding:6px 10px;border-radius:999px;border:none;background:#fff;color:var(--accent);font-weight:700}
    .pagination{display:flex;gap:8px;justify-content:center;margin-top:12px}.page-btn{padding:8px 12px;border-radius:10px;border:1px solid #eee;background:var(--card);cursor:pointer}

    /* Layout */
    main{padding:16px;max-width:1200px;margin:0 auto}
    .hero{display:flex;flex-direction:column;gap:12px}
    .hero-top{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .logo-box{display:flex;align-items:center;gap:12px}
    .hero-center{flex:1;text-align:center}
    .rotating-text{font-size:1.1rem;font-weight:800;color:var(--accent);min-height:48px;display:flex;align-items:center;justify-content:center}
    .top-three{display:flex;gap:10px;justify-content:center;flex-wrap:nowrap;overflow:hidden}
    .small-card{flex:0 0 28%;min-width:90px;height:110px;background:var(--card);border-radius:12px;display:flex;align-items:center;justify-content:center;padding:8px;box-shadow:var(--shadow);cursor:pointer}
    .small-card img{max-width:100%;max-height:100%;object-fit:contain}
    .slider{width:100%;height:220px;background:var(--card);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center}
    .slides{display:flex;height:100%;transition:transform .6s ease}
    .slide{min-width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:12px}
    .slide img{max-height:180px;max-width:90%;object-fit:contain;border-radius:10px}
    .dots{display:flex;gap:8px;justify-content:center;margin-top:8px}.dot{width:10px;height:10px;border-radius:50%;background:rgba(0,0,0,0.12);cursor:pointer}.dot.active{background:var(--accent)}
    .section{margin-top:18px} .section h2{margin:0 0 6px 0}
    .products-grid{display:grid;gap:14px;grid-template-columns:repeat(3,1fr)}
    .product-card{background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px;align-items:center}
    .product-card img{width:100%;height:160px;object-fit:contain;border-radius:8px}
    .product-meta{width:100%;text-align:center}.product-meta h4{margin:6px 0 4px 0;font-size:1rem}.product-meta p{margin:0;color:var(--muted);font-size:.95rem}
    .card-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
    .center-card{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow);margin:16px 0}
    .cart-item{display:flex;gap:12px;align-items:center;justify-content:space-between;border-radius:10px;padding:10px;background:#fff}
    .cart-item img{height:72px;width:72px;object-fit:contain;border-radius:8px}
    .feedback-list{display:flex;flex-direction:column;gap:10px;margin-top:12px}.fb-item{background:#fff;padding:10px;border-radius:10px;box-shadow:var(--shadow)}
    .admin-panel{position:fixed;right:-520px;top:80px;width:520px;background:var(--card);border-radius:12px;padding:14px;box-shadow:0 30px 60px rgba(2,6,23,0.12);transition:right .35s;z-index:220;max-height:82vh;overflow:auto}
    .admin-panel.active{right:16px}.admin-row{display:flex;flex-direction:column;gap:8px;margin-top:10px}.admin-row input,.admin-row textarea,.admin-row select{padding:10px;border-radius:8px;border:1px solid #eee}
    .modal{display:none;position:fixed;inset:0;background:rgba(2,6,23,0.45);align-items:center;justify-content:center;z-index:300;padding:18px}.modal.show{display:flex}
    .modal-card{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow);max-width:720px;width:100%;position:relative}.modal-close{position:absolute;right:8px;top:8px;border:none;background:transparent;font-size:18px;cursor:pointer}
    .muted{color:var(--muted)} .hidden{display:none} .page{display:none}.page.active{display:block}
    .avatar{ width:36px;height:36px;border-radius:50%; object-fit:cover;background:#fff;box-shadow:var(--shadow); border:2px solid rgba(255,255,255,.8); }

    /* 3D + Animated Buttons (overrides) */
    .btn, .pill, .page-btn{
      position:relative; padding:10px 14px; border-radius:12px; border:none; font-weight:800; letter-spacing:.2px;
      background: linear-gradient(180deg,#ffffff,#f1f5f9); color:#0f172a;
      box-shadow: 0 12px 26px rgba(2,6,23,.10), 0 8px 12px rgba(2,6,23,.06), inset 0 1px 0 rgba(255,255,255,.9), inset 0 -4px 8px rgba(2,6,23,.08);
      transform: translateZ(0); transition: transform .18s cubic-bezier(.2,.9,.25,1), box-shadow .18s, filter .3s; cursor:pointer; user-select:none;
    }
    .btn::after, .pill::after, .page-btn::after{
      content:""; position:absolute; inset:0; border-radius:inherit;
      background: radial-gradient(ellipse at 50% 0%, rgba(255,255,255,.45), rgba(255,255,255,0) 60%);
      pointer-events:none; mix-blend-mode: screen;
    }
    .btn.wave::before, .pill.wave::before, .page-btn.wave::before{
      content:""; position:absolute; inset:-2px; border-radius:inherit;
      background: conic-gradient(from 0deg at 50% 50%, rgba(255,255,255,.2), rgba(255,255,255,0) 25%, rgba(255,255,255,.2) 50%, rgba(255,255,255,0) 75%, rgba(255,255,255,.2) 100%);
      filter: blur(10px); opacity:0; transition:opacity .35s ease;
    }
    .btn.wave:hover::before, .pill.wave:hover::before, .page-btn.wave:hover::before{ opacity:1; }
    .btn:hover, .pill:hover, .page-btn:hover{
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 22px 40px rgba(2,6,23,.18), inset 0 -6px 10px rgba(2,6,23,.12);
    }
    .btn:active, .pill:active, .page-btn:active{
      transform: translateY(0) scale(.98);
      box-shadow: 0 12px 24px rgba(2,6,23,.14), inset 0 -2px 6px rgba(2,6,23,.25);
    }
    .btn.primary, .pill.primary, .page-btn.active{
      background: linear-gradient(180deg, var(--accent-2), var(--accent));
      color:#fff;
      box-shadow: 0 14px 30px var(--btn-shadow), 0 10px 14px rgba(2,6,23,.12), inset 0 1px 0 rgba(255,255,255,.28), inset 0 -6px 12px rgba(2,6,23,.22);
    }
    .pill.warn{background: linear-gradient(180deg,#fbbf24,#f59e0b); color:#fff; box-shadow: 0 12px 24px rgba(245,158,11,.35), inset 0 -6px 12px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.25);}
    .pill.danger{background: linear-gradient(180deg,#ef4444,#dc2626) !important; color:#fff !important; box-shadow: 0 12px 24px rgba(239,68,68,.35), inset 0 -6px 12px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.25) !important;}

    @media (max-width:1000px){.products-grid{grid-template-columns:repeat(2,1fr)}.small-card{flex:0 0 32%}}
    @media (max-width:640px){.nav{display:none}.top-three{gap:8px;overflow:auto;padding:6px}.small-card{flex:0 0 30%}.slider{height:180px}.product-card img{width:100%;height:auto;max-height:140px}.products-grid{grid-template-columns:repeat(1,1fr)}.hero-top{flex-direction:column;align-items:center;gap:8px}main{padding:12px}.admin-panel{width:94%}.topbar{flex-wrap:wrap;gap:8px}.top-actions{flex-wrap:wrap;width:100%;justify-content:center}.top-actions .btn{flex:1 1 calc(50% - 12px);margin-top:6px}}

    /* 3D + wave glow for top nav links */
    .nav a{
      position:relative; background: linear-gradient(180deg,#ffffff,#f1f5f9); color:#0f172a !important;
      border-radius:12px; font-weight:800; letter-spacing:.2px; padding:10px 14px;
      box-shadow: 0 12px 26px rgba(2,6,23,.10), 0 8px 12px rgba(2,6,23,.06), inset 0 1px 0 rgba(255,255,255,.9), inset 0 -4px 8px rgba(2,6,23,.08);
      transition: transform .18s cubic-bezier(.2,.9,.25,1), box-shadow .18s; text-decoration:none;
    }
    .nav a::after{ content:""; position:absolute; inset:0; border-radius:inherit; background: radial-gradient(ellipse at 50% 0%, rgba(255,255,255,.45), rgba(255,255,255,0) 60%); pointer-events:none; mix-blend-mode: screen; }
    .nav a.wave::before{ content:""; position:absolute; inset:-2px; border-radius:inherit; background: conic-gradient(from 0deg at 50% 50%, rgba(255,255,255,.2), rgba(255,255,255,0) 25%, rgba(255,255,255,.2) 50%, rgba(255,255,255,0) 75%, rgba(255,255,255,.2) 100%); filter: blur(10px); opacity:0; transition:opacity .35s ease; }
    .nav a.wave:hover::before{ opacity:1; }
    .nav a:hover{ transform: translateY(-4px) scale(1.02); box-shadow: 0 22px 40px rgba(2,6,23,.18), inset 0 -6px 10px rgba(2,6,23,.12); }
    .nav a:active{ transform: translateY(0) scale(.98); box-shadow: 0 12px 24px rgba(2,6,23,.14), inset 0 -2px 6px rgba(2,6,23,.25); }
    .nav a.active{ background: linear-gradient(180deg, var(--accent-2), var(--accent)); color:#fff !important;
      box-shadow: 0 14px 30px var(--btn-shadow), 0 10px 14px rgba(2,6,23,.12), inset 0 1px 0 rgba(255,255,255,.28), inset 0 -6px 12px rgba(2,6,23,.22); }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand-left">
      <img id="siteLogo" src="" alt="‡¶¶‡¶æ‡¶â‡¶¶ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ Logo">
      <div><div class="brand-title">‡¶¶‡¶æ‡¶â‡¶¶ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞</div><div class="brand-sub">Quality ‚Ä¢ Trust ‚Ä¢ Fast</div></div>
    </div>
    <nav class="nav" aria-label="Main">
      <a href="#home" class="nav-link wave">Home</a>
      <a href="#products" class="nav-link wave">Products</a>
      <a href="#cart" class="nav-link wave">Cart</a>
      <a href="#contact" class="nav-link wave">Contact</a>
      <a href="#feedback" class="nav-link wave">Feedback</a>
    </nav>
    <div class="top-actions">
      <img id="adminAvatar" class="avatar" alt="Admin" title="Site Admin" />
      <img id="userAvatar" class="avatar hidden" alt="You" title="You" />
      <button id="userAuthBtn" class="btn small wave">Sign Up / Login</button>
      <button id="userLogoutBtn" class="btn small hidden wave">Logout</button>
      <button id="adminOpenBtn" class="btn primary small wave">Admin</button>
    </div>
  </header>

  <div id="adminAlert" class="hidden" style="background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;position:fixed;top:80px;right:16px;z-index:500;box-shadow:0 4px 12px rgba(0,0,0,0.1);"></div>

  <main>
    <section id="home" class="page active">
      <div class="hero">
        <div class="hero-top">
          <div class="logo-box"><img id="heroLogo" src="" alt="logo" style="width:64px;height:64px;border-radius:10px;object-fit:contain"></div>
          <div class="hero-center"><div id="rotatingText" class="rotating-text">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‚Äî ‡¶¶‡¶æ‡¶â‡¶¶ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞</div></div>
          <div style="width:64px"></div>
        </div>
        <div class="top-three" id="topThree"></div>
        <div class="slider" id="sliderWrap"><div class="slides" id="slides"></div></div>
        <div class="dots" id="slideDots"></div>
      </div>
      <section class="section">
        <div style="display:flex;justify-content:space-between;align-items:center"><h2>Trending Products</h2><div id="productsCount" class="muted"></div></div>
        <div id="productsGrid" class="products-grid"></div>
        <div id="pagination" class="pagination"></div>
      </section>
    </section>

    <section id="product-view" class="page"><div class="center-card" id="productViewCard"></div></section>

    <section id="products" class="page">
      <div class="center-card">
        <h2>All Products</h2>
        <input id="productSearchInput" placeholder="‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." style="width:100%;padding:10px;border-radius:8px;border:1px solid #eee;margin-top:6px;margin-bottom:8px" />
        <div id="productsGridFull" class="products-grid"></div>
        <div id="paginationFull" class="pagination"></div>
      </div>
    </section>

    <section id="cart" class="page">
      <div class="center-card">
        <h2>Your Cart</h2>
        <div id="cartItems" class="card-list"></div>
        <div style="text-align:center;margin-top:12px"><button id="checkoutBtn" class="btn primary wave">Checkout (Demo)</button></div>
      </div>
    </section>

    <section id="contact" class="page">
      <div class="center-card">
        <h2>Contact</h2>
        <p class="muted">Contact via WhatsApp or Messenger (set by admin).</p>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
          <button id="contactWhatsapp" class="btn wave" style="background:#25D366;color:#fff">WhatsApp</button>
          <button id="contactMessenger" class="btn wave" style="background:#0084FF;color:#fff">Messenger</button>
        </div>
      </div>
    </section>

    <section id="feedback" class="page">
      <div class="center-card">
        <h2>Feedback</h2>
        <div style="margin-top:10px">
          <h3>Website feedback</h3>
          <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
            <button id="siteGoodBtn" class="btn wave">üëç Good (<span id="goodCount">0</span>)</button>
            <button id="siteBadBtn" class="btn wave">üëé Bad (<span id="badCount">0</span>)</button>
          </div>
        </div>
        <div style="margin-top:14px">
          <h3>Product feedback</h3>
          <label>Search product</label>
          <input id="feedbackSearch" placeholder="Type product name..." style="width:100%;padding:10px;border-radius:8px;border:1px solid #eee;margin-top:6px" />
          <div id="feedbackSearchResults" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px"></div>
          <div id="selectedFeedbackProduct" style="display:none;margin-top:12px">
            <div style="display:flex;gap:10px;align-items:center">
              <img id="feedbackSelectedImg" src="" alt="" style="height:92px;border-radius:8px;box-shadow:var(--shadow)">
              <div><strong id="feedbackSelectedName"></strong><br><span id="feedbackSelectedPrice" class="muted"></span></div>
            </div>
            <textarea id="feedbackText" placeholder="Write your feedback..." rows="4" style="width:100%;margin-top:10px;padding:10px;border:1px solid #eee;border-radius:8px"></textarea>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
              <button id="submitFeedbackBtn" class="btn primary wave">Submit Feedback</button>
              <button id="viewFeedbacksBtn" class="btn wave">View All</button>
            </div>
          </div>
          <div id="feedbackList" class="feedback-list" style="margin-top:12px"></div>
        </div>
      </div>
    </section>
  </main>

  <aside id="adminPanel" class="admin-panel" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Admin Panel</h3>
      <div><button id="closeAdmin" class="btn small wave">‚úï</button></div>
    </div>

    <div class="admin-row admin-only" style="display:none">
      <label><strong>Upload Logo</strong></label>
      <input id="logoInput" type="file" accept="image/*" />
      <button id="logoSetBtn" class="btn wave">Upload Logo</button>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>Upload Product</strong></label>
      <input id="productImageInput" type="file" accept="image/*" />
      <input id="productName" type="text" placeholder="Product name" />
      <input id="productPrice" type="text" placeholder="Price" />
      <input id="productDesc" type="text" placeholder="Short description" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="addProductBtn" class="btn primary wave">Add Product</button>
        <button id="clearProductsBtn" class="btn wave">Clear All</button>
      </div>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>Animated sentences (comma separated)</strong></label>
      <textarea id="sentencesInput" placeholder="Welcome!, Best deals!, Fast delivery" rows="3"></textarea>
      <button id="saveSentencesBtn" class="btn primary wave">Save Sentences</button>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>Currency Symbol (shown on product cards)</strong></label>
      <input id="currencyInput" type="text" placeholder="‡ß≥ or $" />
      <button id="setCurrencyBtn" class="btn wave">Set Currency</button>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>WhatsApp (country + number)</strong></label>
      <div style="display:flex;gap:8px">
        <select id="whatsappCountry">
          <option value="+880" selected>+880 (BD)</option><option value="+91">+91 (IN)</option>
          <option value="+1">+1 (US)</option><option value="+44">+44 (UK)</option><option value="+971">+971 (UAE)</option>
        </select>
        <input id="whatsappNumber" placeholder="1XXXXXXXXX" />
      </div>
      <label style="margin-top:8px"><strong>Messenger link</strong></label>
      <input id="messengerInput" placeholder="https://m.me/username" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveContactsBtn" class="btn primary wave">Save Contacts</button>
        <button id="openContactsBtn" class="btn wave">Test Contact</button>
      </div>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>Registered Users</strong></label>
      <div id="usersList" class="center-card" style="max-height:220px;overflow:auto"></div>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>Admin Email</strong></label>
      <input id="changeAdminEmailInput" type="email" placeholder="admin@example.com" />
      <button id="changeAdminEmailBtn" class="btn wave">Save Admin Email</button>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>Admin Password</strong></label>
      <input id="changeAdminPassInput" type="password" placeholder="new password" />
      <button id="changeAdminPassBtn" class="btn wave">Save Admin Password</button>
    </div>

    <div class="admin-row admin-only" style="display:none;margin-top:10px">
      <label><strong>Export / Backup</strong></label>
      <button id="exportJsonBtn" class="btn wave">Download products.json</button>
      <button id="importJsonBtn" class="btn wave">Import products.json</button>
      <input id="uploadJsonInput" type="file" accept="application/json" class="hidden" />
    </div>
  
      <div style="margin-top:10px">
        <label><strong>Sync Endpoint (serverless URL)</strong></label>
        <input id="syncEndpointInput" placeholder="https://your-site.vercel.app/api/update-products" />
        <label style="margin-top:8px"><strong>App Key (optional)</strong></label>
        <input id="syncAppKeyInput" placeholder="Only if your endpoint checks X-App-Key" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="saveSyncEndpointBtn" class="btn wave">Save Endpoint</button>
          <button id="testPushBtn" class="btn wave">Test Push</button>
        </div>
        <p class="muted" style="margin-top:6px">
          Tip: Endpoint keeps your GitHub token safe on serverless (Vercel/Netlify). The site will POST changes to update <code>products.json</code> automatically.
        </p>
      </div>

</aside>

  <div id="adminGateModal" class="modal">
    <div class="modal-card">
      <button class="modal-close" data-close>‚úï</button>
      <h3>Admin Login</h3>
      <input id="gateEmail" type="email" placeholder="Admin email" />
      <input id="gatePass" type="password" placeholder="Admin password" />
      <div style="display:flex;gap:8px;margin-top:8px"><button id="gateLoginBtn" class="btn primary wave">Login</button></div>
    </div>
  </div>

  <div id="shareModal" class="modal">
    <div class="modal-card">
      <button class="modal-close" data-close>‚úï</button>
      <h3>Share ‡¶¶‡¶æ‡¶â‡¶¶ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞</h3>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="shareWhatsapp" class="btn wave" style="background:#25D366;color:#fff">WhatsApp</button>
        <button id="shareMessenger" class="btn wave" style="background:#0084FF;color:#fff">Messenger</button>
        <button id="copyLinkBtn" class="btn wave">Copy Link</button>
      </div>
      <p class="muted" style="margin-top:8px">Note: Host on GitHub Pages/Netlify (not file://).</p>
    </div>
  </div>

  <div id="userModal" class="modal">
    <div class="modal-card">
      <button class="modal-close" data-close>‚úï</button>
      <h3>Sign Up / Login</h3>
      <input id="userEmail" type="email" placeholder="Email" />
      <input id="userPass" type="password" placeholder="Password" />
      <div class="row" id="rememberUserRow" style="margin:8px 0">
        <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="rememberMeToggle" /><span>Remember me</span></label>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="userSignupBtn" class="btn primary wave">Sign Up</button>
        <button id="userLoginBtn" class="btn wave">Login</button>
      </div>
    </div>
  </div>

  <div id="viewFeedbackModal" class="modal">
    <div class="modal-card">
      <button class="modal-close" data-close>‚úï</button>
      <h3>All Feedbacks</h3>
      <div id="allFeedbacks"></div>
    </div>
  </div>

  <script>
  /* ---------- Utils & Storage ---------- */
  function setCookie(name, value, days){
    try{ var d=new Date(); d.setTime(d.getTime()+days*24*60*60*1000);
      document.cookie = name + "=" + encodeURIComponent(value) + ";expires=" + d.toUTCString() + ";path=/"; }catch(e){}
  }
  function getCookie(name){
    try{ var cname = name + "="; var arr = document.cookie.split(';');
      for(var i=0;i<arr.length;i++){ var c=arr[i].trim(); if(c.indexOf(cname)===0) return decodeURIComponent(c.substring(cname.length)); }
    }catch(e){} return null;
  }
  const Storage = {
    get: (k, def=null) => { try{ var v = localStorage.getItem(k); if(v!==null) return v; }catch(e){} var cv = getCookie(k); return cv!==null ? cv : def; },
    set: (k, v) => { try{ localStorage.setItem(k, v); }catch(e){} setCookie(k, v, 365); },
    remove: (k) => { try{ localStorage.removeItem(k); }catch(e){} setCookie(k, "", -1); }
  };
  function _b64e(str){ try{return btoa(unescape(encodeURIComponent(str)));}catch(e){ return btoa(str);} }
  function _b64d(str){ try{return decodeURIComponent(escape(atob(str)));}catch(e){ return atob(str);} }

  /* ---------- Global State ---------- */
  const LS_KEYS={ REMEMBER_USER:'remember_user', REMEMBER_ADMIN:'remember_admin',  SITE:'daudSite', PRODUCTS:'daudProducts', CART:'daudCart', FEEDBACKS:'daudFeedbacks', SITE_FEEDBACK:'daudSiteFeedback', ADMIN:'daudAdmin', LIKES:'daudLikes', LIKE_COUNTS:'daudLikeCounts', DISLIKE_COUNTS:'daudDislikeCounts', USERS:'daudUsers', CURRENT_USER:'daudCurrentUser', ADMIN_LOGGED_IN:'daudAdminLoggedIn'};
  const DEFAULT_PRODUCTS=[{id:1,name:'Sample Product',price:'100',desc:'This is a sample product for demonstration.',image:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAA5klEQVR4nO3QQQkAIADAQLV/Z63gXiLcJRibe3BrvQ74iVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWYFZgVmBWcEBil4Bx/GEGnoAAAAASUVORK5CYII='}];
  let rotatingSentences=['‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‚Äî ‡¶¶‡¶æ‡¶â‡¶¶ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞','Best deals!','Fast delivery']; let currencySymbol='‡ß≥'; let whatsappLink=''; let messengerLink=''; let publicLink='';
  let users=[]; let currentUser=null; let products=[]; const ITEMS_PER_PAGE=6; let currentPageHome=1; let currentPageFull=1; let cart=[]; let likes=[]; let likeCounts={}; let dislikeCounts={};
  let adminLoggedIn=false; let selectedProduct=null; let allFeedback=[];

  /* ---------- Elements ---------- */
  const pages=document.querySelectorAll('.page'); const navLinks=document.querySelectorAll('.nav-link');
  const siteLogo=document.getElementById('siteLogo'); const heroLogo=document.getElementById('heroLogo'); const rotatingText=document.getElementById('rotatingText');
  const topThree=document.getElementById('topThree'); const slides=document.getElementById('slides'); const slideDots=document.getElementById('slideDots');
  const productsGrid=document.getElementById('productsGrid'); const productsGridFull=document.getElementById('productsGridFull'); const pagination=document.getElementById('pagination'); const paginationFull=document.getElementById('paginationFull'); const productsCount=document.getElementById('productsCount');
  const productViewCard=document.getElementById('productViewCard'); const cartItems=document.getElementById('cartItems');
  const productSearchInput=document.getElementById('productSearchInput'); let filteredProducts=[];
  const feedbackSearch=document.getElementById('feedbackSearch'); const feedbackSearchResults=document.getElementById('feedbackSearchResults'); const selectedFeedbackProduct=document.getElementById('selectedFeedbackProduct'); const feedbackSelectedImg=document.getElementById('feedbackSelectedImg'); const feedbackSelectedName=document.getElementById('feedbackSelectedName'); const feedbackSelectedPrice=document.getElementById('feedbackSelectedPrice'); const feedbackText=document.getElementById('feedbackText'); const submitFeedbackBtn=document.getElementById('submitFeedbackBtn'); const viewFeedbacksBtn=document.getElementById('viewFeedbacksBtn'); const allFeedbacks=document.getElementById('allFeedbacks'); const goodCount=document.getElementById('goodCount'); const badCount=document.getElementById('badCount'); const feedbackList=document.getElementById('feedbackList');
  const publicLinkInput=document.getElementById('publicLinkInput'); const savePublicLinkBtn=document.getElementById('savePublicLinkBtn');
  const userAuthBtn=document.getElementById('userAuthBtn'); const userLogoutBtn=document.getElementById('userLogoutBtn');
  const adminOpenBtn=document.getElementById('adminOpenBtn'); const adminAvatar=document.getElementById('adminAvatar'); const userAvatar=document.getElementById('userAvatar');
  const adminPanel=document.getElementById('adminPanel'); const closeAdmin=document.getElementById('closeAdmin');
  const logoInput=document.getElementById('logoInput'); const logoSetBtn=document.getElementById('logoSetBtn');
  const productImageInput=document.getElementById('productImageInput'); const productName=document.getElementById('productName'); const productPrice=document.getElementById('productPrice'); const productDesc=document.getElementById('productDesc'); const addProductBtn=document.getElementById('addProductBtn'); const clearProductsBtn=document.getElementById('clearProductsBtn');
  const viewFeedbacksModal=document.getElementById('viewFeedbackModal'); const userModal=document.getElementById('userModal'); const shareModal=document.getElementById('shareModal');
  const sentencesInput=document.getElementById('sentencesInput'); const saveSentencesBtn=document.getElementById('saveSentencesBtn'); const currencyInput=document.getElementById('currencyInput'); const setCurrencyBtn=document.getElementById('setCurrencyBtn'); const whatsappCountry=document.getElementById('whatsappCountry'); const whatsappNumber=document.getElementById('whatsappNumber'); const messengerInput=document.getElementById('messengerInput'); const saveContactsBtn=document.getElementById('saveContactsBtn'); const openContactsBtn=document.getElementById('openContactsBtn'); const openShare=document.getElementById('openShare');
  const changeAdminEmailInput=document.getElementById('changeAdminEmailInput'); const changeAdminEmailBtn=document.getElementById('changeAdminEmailBtn'); const changeAdminPassInput=document.getElementById('changeAdminPassInput'); const changeAdminPassBtn=document.getElementById('changeAdminPassBtn');
  const adminGateModal=document.getElementById('adminGateModal'); const gateEmail=document.getElementById('gateEmail'); const gatePass=document.getElementById('gatePass'); const gateLoginBtn=document.getElementById('gateLoginBtn');
  document.querySelectorAll('[data-close]').forEach(btn => btn.addEventListener('click', e => e.target.closest('.modal').classList.remove('show')));
  document.querySelectorAll('.modal').forEach(m => { m.addEventListener('click', e => { const card = m.querySelector('.modal-card'); if(!card.contains(e.target)) m.classList.remove('show'); }); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ document.querySelectorAll('.modal.show').forEach(m=>m.classList.remove('show')); } });

  /* ---------- Device ownership for guest feedback ---------- */
  function getDeviceId(){
    try{
      let id = Storage.get('daudDevice', null);
      if(!id){ id = 'dvc_' + Math.random().toString(36).slice(2) + Date.now().toString(36); Storage.set('daudDevice', id); }
      return id;
    }catch(e){ return 'dvc_fallback'; }
  }
  function canManageFeedback(fb){
    const deviceId = getDeviceId();
    const isOwner = !!(currentUser && (fb.user||'').toLowerCase()===String(currentUser).toLowerCase());
    const sameDevice = fb.device && fb.device===deviceId;
    return !!(adminLoggedIn || isOwner || sameDevice);
  }

  /* ---------- Init ---------- */
  if (document.readyState!=='loading') initApp(); else document.addEventListener('DOMContentLoaded', initApp);
  function initApp(){ setupNavigation(); loadSiteSettings(); loadProducts(); loadCart(); loadLikes(); loadLikeCounts(); setupFeedbackSystem(); autoRotateText(); initAdminPanel(); initUserSystem(); if(productSearchInput) productSearchInput.addEventListener('input', handleProductSearch); }

  /* ---------- Navigation ---------- */
  function setupNavigation(){
    function setActiveNav(target){
      navLinks.forEach(a=>{
        const id=((a.getAttribute('href')||'').replace('#','')||'home');
        a.classList.toggle('active', id===target);
      });
    }
    function switchPage(target){
      pages.forEach(p=>p.classList.remove('active'));
      var el = document.getElementById(target) || document.getElementById('home');
      if(el) el.classList.add('active');
      setActiveNav(target||'home');
    }
    navLinks.forEach(link=>{
      link.addEventListener('click', e=>{
        e.preventDefault();
        const pageId=(link.getAttribute('href')||'').replace('#','')||'home';
        switchPage(pageId);
      });
    });
    switchPage('home');
  }

  /* ---------- Site settings ---------- */
  function loadSiteSettings(){
    try{
      const saved3 = JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
      const se = document.getElementById('syncEndpointInput'); if(se) se.value = saved3.syncEndpoint || '';
      const sk = document.getElementById('syncAppKeyInput');   if(sk) sk.value = saved3.syncAppKey   || '';
    }catch(_){}

    const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
    if(!saved.adminEmail) saved.adminEmail='mdipml000@gmail.com';
    if(!saved.adminPass) saved.adminPass='daud@2025';
    localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved));
    if(saved.logo){ siteLogo.src=heroLogo.src=saved.logo; }
    if(saved.sentences){ rotatingSentences=saved.sentences.split(',').map(s=>s.trim()).filter(Boolean);}
    if(saved.currency){ currencySymbol=saved.currency;}
    if(saved.whatsapp){ whatsappLink=saved.whatsapp;}
    if(saved.messenger){ messengerLink=saved.messenger;}
    if(saved.publicLink){ publicLink=saved.publicLink; if(publicLinkInput) publicLinkInput.value=publicLink;}
    refreshAdminAvatar();
    refreshUserUI();
  }
  function importSettingsFromRemote(obj){
    if(!obj) return;
    const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
    ['logo','currency','sentences','whatsapp','messenger','adminEmail','adminPass','publicLink'].forEach(k=>{ if(obj[k]) saved[k]=obj[k]; });
    localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved));
    if(saved.logo){ siteLogo.src=heroLogo.src=saved.logo; }
    if(saved.currency){ currencySymbol=saved.currency;}
    if(saved.sentences){ rotatingSentences=saved.sentences.split(',').map(s=>s.trim()).filter(Boolean);}
    if(saved.whatsapp){ whatsappLink=saved.whatsapp;}
    if(saved.messenger){ messengerLink=saved.messenger;}
    if(saved.publicLink){ publicLink=saved.publicLink; if(publicLinkInput) publicLinkInput.value=publicLink;}
    refreshAdminAvatar();
  }
  function emailAvatar(email,size=64){ const c=document.createElement('canvas'); c.width=c.height=size; const x=c.getContext('2d'); const t=(email||'user@example.com').trim().toLowerCase(); let h=0; for(let i=0;i<t.length;i++){h=((h<<5)-h)+t.charCodeAt(i);h|=0;} const hue=Math.abs(h)%360; x.fillStyle=`hsl(${hue} 70% 55%)`; x.beginPath(); x.arc(size/2,size/2,size/2,0,Math.PI*2); x.fill(); const n=t.split('@')[0]; const ini=n.split(/[._-]+/).slice(0,2).map(s=>s[0]||'').join('').toUpperCase()||'U'; x.fillStyle='#fff'; x.font=`${Math.floor(size*0.45)}px sans-serif`; x.textAlign='center'; x.textBaseline='middle'; x.fillText(ini,size/2,size/2+1); return c.toDataURL('image/png'); }
  function refreshAdminAvatar(){ const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}'); if(saved.adminEmail){ adminAvatar.src=emailAvatar(saved.adminEmail,72); adminAvatar.classList.remove('hidden'); adminAvatar.title=`Admin: ${saved.adminEmail}`; } }
  function refreshUserUI(){
    if(currentUser){
      userAuthBtn.classList.add('hidden');
      userAvatar.src=emailAvatar(currentUser,72);
      userAvatar.classList.remove('hidden');
      userAvatar.title=currentUser;
      userLogoutBtn.classList.remove('hidden');
    } else {
      userAuthBtn.classList.remove('hidden');
      userAvatar.classList.add('hidden');
      userLogoutBtn.classList.add('hidden');
    }
  }

  /* ---------- Products ---------- */
  function loadProducts(){
    products=DEFAULT_PRODUCTS.slice(); updateProductsUI();
    try{
      const local=JSON.parse(localStorage.getItem(LS_KEYS.PRODUCTS)||'[]');
      if(Array.isArray(local)&&local.length){ products=local; updateProductsUI(); }
    }catch(_){};
  }
  function updateProductsUI(){ productsCount.textContent=products.length?`${products.length} items`:'No products yet'; filteredProducts=[]; renderProducts(1); renderProductsFull(1); renderTopThree(); initSlider(); }
  function renderProducts(page){
    currentPageHome=page; productsGrid.innerHTML=''; pagination.innerHTML='';
    const arr=products; const start=(page-1)*3; const paginated=arr.slice(start,start+3);
    if(!arr.length){ const msg=document.createElement('div'); msg.className='muted'; msg.style.textAlign='center'; msg.style.padding='12px'; msg.textContent='No products available. Please log in as admin to add products.'; productsGrid.appendChild(msg); return; }
    paginated.forEach(p=>productsGrid.appendChild(createProductCard(p,false)));
    const pagesCount=Math.ceil(arr.length/3); if(pagesCount>1){ const prev=pageButton('Prev',()=>page>1&&renderProducts(page-1)); if(page===1) prev.disabled=true; pagination.appendChild(prev);} for(let i=1;i<=pagesCount;i++){ const b=pageButton(i,()=>renderProducts(i)); if(i===page) b.classList.add('active'); pagination.appendChild(b);} if(pagesCount>1){ const next=pageButton('Next',()=>page<pagesCount&&renderProducts(page+1)); if(page===pagesCount) next.disabled=true; pagination.appendChild(next);}
  }
  function renderProductsFull(page){
    currentPageFull=page; productsGridFull.innerHTML=''; paginationFull.innerHTML='';
    const arr=filteredProducts.length?filteredProducts:products; const start=(page-1)*ITEMS_PER_PAGE; const paginated=arr.slice(start,start+ITEMS_PER_PAGE);
    if(!arr.length){ const msg=document.createElement('div'); msg.className='muted'; msg.style.textAlign='center'; msg.style.padding='12px'; msg.textContent='No products available. Please log in as admin to add products.'; productsGridFull.appendChild(msg); return; }
    paginated.forEach(p=>productsGridFull.appendChild(createProductCard(p,true)));
    const pagesCount=Math.ceil(arr.length/ITEMS_PER_PAGE); if(pagesCount>1){ const prev=pageButton('Prev',()=>page>1&&renderProductsFull(page-1)); if(page===1) prev.disabled=true; paginationFull.appendChild(prev);} for(let i=1;i<=pagesCount;i++){ const b=pageButton(i,()=>renderProductsFull(i)); if(i===page) b.classList.add('active'); paginationFull.appendChild(b);} if(pagesCount>1){ const next=pageButton('Next',()=>page<pagesCount&&renderProductsFull(page+1)); if(page===pagesCount) next.disabled=true; paginationFull.appendChild(next);}
  }
  function pageButton(label,fn){ const b=document.createElement('button'); b.textContent=label; b.className='page-btn wave'; b.addEventListener('click',fn); return b; }
  function createProductCard(item,withView){
    const d=document.createElement('div'); d.className='product-card';
    const img=document.createElement('img'); img.src=item.image; img.alt=item.name; d.appendChild(img);
    const meta=document.createElement('div'); meta.className='product-meta'; meta.innerHTML=`<h4>${item.name}</h4><p>${currencySymbol}${item.price}</p>`; d.appendChild(meta);
    const actions=document.createElement('div'); actions.className='card-actions';
    const cartBtn=chip('Add to Cart',()=>addToCart(item)); actions.appendChild(cartBtn);
    const likedByUser=likes.includes(item.id), likeCount=likeCounts[item.id]||0, dislikeCount=dislikeCounts[item.id]||0;
    const likeBtn=chip((likedByUser?'Dislike':'Like')+` (${likeCount}/${dislikeCount})`,()=>toggleLike(item.id)); actions.appendChild(likeBtn);
    if(withView){ actions.appendChild(chip('View',()=>viewProduct(item))); }
    if(adminLoggedIn){
      const eBtn=chip('Edit',()=>editProduct(item.id));  eBtn.classList.add('warn','wave'); actions.appendChild(eBtn);
      const dBtn=chip('Delete',()=>deleteProduct(item.id)); dBtn.classList.add('danger','wave'); actions.appendChild(dBtn);
    }
    d.appendChild(actions); return d;
  }
  function chip(text,fn){ const b=document.createElement('button'); b.className='pill wave'; b.textContent=text; b.addEventListener('click',fn); return b; }
  function handleProductSearch(){ const q=productSearchInput.value.trim().toLowerCase(); filteredProducts=q?products.filter(p=>p.name.toLowerCase().includes(q)):[]; renderProductsFull(1); }

  /* Cart */
  function loadCart(){ cart=JSON.parse(localStorage.getItem(LS_KEYS.CART)||'[]'); renderCart(); } function saveCart(){ localStorage.setItem(LS_KEYS.CART, JSON.stringify(cart)); }
  function addToCart(item){ const existing=cart.find(i=>i.id===item.id); if(existing) existing.qty+=1; else cart.push({...item,qty:1}); saveCart(); renderCart(); alert('Product added to cart'); }
  function removeFromCart(id){ cart=cart.filter(i=>i.id!==id); saveCart(); renderCart(); }
  function renderCart(){
    cartItems.innerHTML='';
    if(!cart.length){ cartItems.innerHTML='<p class="muted">Cart is empty</p>'; return; }
    cart.forEach(item=>{
      const w=document.createElement('div'); w.className='cart-item';
      w.innerHTML=`<div style="display:flex;gap:10px;align-items:center"><img src="${item.image}" alt="${item.name}"><div><strong>${item.name}</strong><br><span>${currencySymbol}${item.price} x ${item.qty}</span></div></div><button class="pill danger wave">Remove</button>`;
      const btn=w.querySelector('button'); btn.addEventListener('click',()=>removeFromCart(item.id));
      cartItems.appendChild(w);
    });
  }
  function loadLikes(){ likes=JSON.parse(localStorage.getItem(LS_KEYS.LIKES)||'[]'); } function saveLikes(){ localStorage.setItem(LS_KEYS.LIKES, JSON.stringify(likes)); }
  function loadLikeCounts(){ likeCounts=JSON.parse(localStorage.getItem(LS_KEYS.LIKE_COUNTS)||'{}'); dislikeCounts=JSON.parse(localStorage.getItem(LS_KEYS.DISLIKE_COUNTS)||'{}'); }
  function saveLikeCounts(){ localStorage.setItem(LS_KEYS.LIKE_COUNTS, JSON.stringify(likeCounts)); localStorage.setItem(LS_KEYS.DISLIKE_COUNTS, JSON.stringify(dislikeCounts)); }
  function toggleLike(id){ const idx=likes.indexOf(id); if(idx===-1){ likes.push(id); likeCounts[id]=(likeCounts[id]||0)+1; } else { likes.splice(idx,1); dislikeCounts[id]=(dislikeCounts[id]||0)+1; } saveLikes(); saveLikeCounts(); renderProducts(currentPageHome); renderProductsFull(currentPageFull); }
  function viewProduct(item){
    productViewCard.innerHTML='';
    const img=document.createElement('img'); img.src=item.image; img.alt=item.name; img.style.width='100%'; img.style.height='220px'; img.style.objectFit='contain'; productViewCard.appendChild(img);
    const h3=document.createElement('h3'); h3.textContent=item.name; productViewCard.appendChild(h3);
    const p=document.createElement('p'); p.textContent=item.desc; productViewCard.appendChild(p);
    const price=document.createElement('strong'); price.textContent=currencySymbol+item.price; productViewCard.appendChild(price);
    const addBtn=document.createElement('button'); addBtn.className='btn primary wave'; addBtn.textContent='Add to Cart'; addBtn.style.marginTop='12px'; addBtn.addEventListener('click',()=>addToCart(item)); productViewCard.appendChild(addBtn);
    pages.forEach(p=>p.classList.remove('active')); document.getElementById('product-view').classList.add('active');
  }

  /* ---------- Feedback ---------- */
  function setupFeedbackSystem(){
    loadFeedbacks();
    feedbackSearch.addEventListener('input', handleFeedbackSearch);
    submitFeedbackBtn.addEventListener('click', submitFeedback);
    viewFeedbacksBtn.addEventListener('click', openAllFeedbacksModal);
    document.getElementById('siteGoodBtn').addEventListener('click',()=>updateSiteFeedback('good'));
    document.getElementById('siteBadBtn').addEventListener('click',()=>updateSiteFeedback('bad'));
  }
  function handleFeedbackSearch(){ const q=feedbackSearch.value.trim().toLowerCase(); feedbackSearchResults.innerHTML=''; if(!q) return; products.filter(p=>p.name.toLowerCase().includes(q)).forEach(item=>{ const b=chip(item.name,()=>selectFeedbackProduct(item)); feedbackSearchResults.appendChild(b); }); }
  function selectFeedbackProduct(item){ selectedProduct=item; feedbackSelectedImg.src=item.image; feedbackSelectedName.textContent=item.name; feedbackSelectedPrice.textContent=currencySymbol+item.price; selectedFeedbackProduct.style.display='block'; feedbackSearchResults.innerHTML=''; feedbackSearch.value=''; }
  function loadFeedbacks(){ allFeedback=JSON.parse(localStorage.getItem(LS_KEYS.FEEDBACKS)||'[]'); const siteFb=JSON.parse(localStorage.getItem(LS_KEYS.SITE_FEEDBACK)||'{"good":0,"bad":0}'); goodCount.textContent=siteFb.good; badCount.textContent=siteFb.bad; renderFeedbackList(); }
  function saveFeedbacks(){ localStorage.setItem(LS_KEYS.FEEDBACKS, JSON.stringify(allFeedback)); }
  function submitFeedback(){
    const text = (feedbackText && feedbackText.value || '').trim();
    if(!selectedProduct || !text){ alert('Please select a product and write feedback'); return; }
    const fb = { id: Date.now(), productId: selectedProduct.id, name: selectedProduct.name, image: selectedProduct.image, text, user: currentUser || 'Guest', device: getDeviceId(), time: new Date().toLocaleString() };
    allFeedback.push(fb);
    saveFeedbacks();
    if(feedbackText) feedbackText.value='';
    if(selectedFeedbackProduct) selectedFeedbackProduct.style.display='none';
    selectedProduct=null;
    renderFeedbackList();
    toast('Feedback submitted ‚úì');
  }
  function editFeedback(id){
    const fb = allFeedback.find(f=>f.id===id);
    if(!fb){ alert('Feedback not found'); return; }
    if(!canManageFeedback(fb)){ alert('Only author or admin can edit'); return; }
    const nt = prompt('Edit your feedback:', fb.text || '');
    if(nt===null) return;
    fb.text = String(nt).trim();
    fb.time = new Date().toLocaleString();
    saveFeedbacks(); renderFeedbackList(); if(viewFeedbacksModal && viewFeedbacksModal.classList.contains('show')) openAllFeedbacksModal();
    toast('Feedback updated ‚úì');
  }
  function deleteFeedback(id){
    const fb = allFeedback.find(f=>f.id===id);
    if(!fb){ alert('Feedback not found'); return; }
    if(!canManageFeedback(fb)){ alert('Only author or admin can delete'); return; }
    if(!confirm('Delete this feedback?')) return;
    allFeedback = allFeedback.filter(f=>f.id!==id);
    saveFeedbacks(); renderFeedbackList(); if(viewFeedbacksModal && viewFeedbacksModal.classList.contains('show')) openAllFeedbacksModal();
    toast('Feedback deleted ‚úì');
  }
  function renderFeedbackList(){
    feedbackList.innerHTML='';
    if(!allFeedback.length){ feedbackList.innerHTML='<p class="muted">No feedback yet</p>'; return; }
    allFeedback.slice().reverse().forEach(fb=>{
      const d=document.createElement('div'); d.className='fb-item';
      const canAct = canManageFeedback(fb);
      d.innerHTML = `<div style="display:flex; gap:10px; align-items:flex-start">
        <img src="${fb.image||''}" alt="${fb.name}" style="width:72px;height:72px;object-fit:contain;border-radius:8px;box-shadow:var(--shadow)">
        <div style="flex:1">
          <strong>${fb.name}</strong>
          <p style="margin:6px 0">${fb.text}</p>
          <small class="muted">${fb.user||'Guest'} ‚Ä¢ ${fb.time}</small>
        </div>
        ${canAct?'<div style="display:flex;gap:6px"><button class="pill warn wave" data-edit>Edit</button><button class="pill danger wave" data-del>Delete</button></div>':''}
      </div>`;
      if(canAct){
        const eb=d.querySelector('[data-edit]'); const db=d.querySelector('[data-del]');
        if(eb) eb.addEventListener('click',()=>editFeedback(fb.id));
        if(db) db.addEventListener('click',()=>deleteFeedback(fb.id));
      }
      feedbackList.appendChild(d);
    });
  }
  function openAllFeedbacksModal(){
    allFeedbacks.innerHTML='';
    if(!allFeedback.length){
      allFeedbacks.innerHTML='<p class="muted">No feedback yet</p>';
    } else {
      allFeedback.slice().reverse().forEach(fb=>{
        const d=document.createElement('div'); d.className='fb-item';
        const canAct = canManageFeedback(fb);
        d.innerHTML=`<div style="display:flex; gap:10px; align-items:flex-start">
          <img src="${fb.image||''}" alt="${fb.name}" style="width:72px;height:72px;object-fit:contain;border-radius:8px;box-shadow:var(--shadow)">
          <div style="flex:1">
            <strong>${fb.name}</strong>
            <p style="margin:6px 0">${fb.text}</p>
            <small class="muted">${fb.user||'Guest'} ‚Ä¢ ${fb.time}</small>
          </div>
          ${canAct?'<div style="display:flex;gap:6px"><button class="pill warn wave" data-edit>Edit</button><button class="pill danger wave" data-del>Delete</button></div>':''}
        </div>`;
        if(canAct){
          const eb=d.querySelector('[data-edit]'); const db=d.querySelector('[data-del]');
          if(eb) eb.addEventListener('click',()=>{ editFeedback(fb.id); openAllFeedbacksModal(); });
          if(db) db.addEventListener('click',()=>{ deleteFeedback(fb.id); openAllFeedbacksModal(); });
        }
        allFeedbacks.appendChild(d);
      });
    }
    viewFeedbacksModal.classList.add('show');
  }
  function updateSiteFeedback(type){
    const siteFb=JSON.parse(localStorage.getItem(LS_KEYS.SITE_FEEDBACK)||'{"good":0,"bad":0}');
    if(type==='good') siteFb.good+=1; else siteFb.bad+=1;
    localStorage.setItem(LS_KEYS.SITE_FEEDBACK, JSON.stringify(siteFb));
    goodCount.textContent=siteFb.good; badCount.textContent=siteFb.bad;
  }

  /* ---------- Slider ---------- */
  let sliderTimer=null;
  function renderTopThree(){ topThree.innerHTML=''; if(!products.length) return; products.slice(0,3).forEach(item=>{ const card=document.createElement('div'); card.className='small-card'; const img=document.createElement('img'); img.src=item.image; img.alt=item.name; card.appendChild(img); card.addEventListener('click',()=>viewProduct(item)); topThree.appendChild(card); }); }
  function initSlider(){
    slides.innerHTML=''; slideDots.innerHTML=''; if(sliderTimer){ clearInterval(sliderTimer); sliderTimer=null;}
    const list=products||[]; if(!list.length) return; const max=Math.min(list.length,6); let current=0;
    for(let i=0;i<max;i++){ const item=list[i]; const sdiv=document.createElement('div'); sdiv.className='slide';
      const img=document.createElement('img'); img.src=item.image; img.alt=item.name; sdiv.appendChild(img); sdiv.addEventListener('click',()=>viewProduct(item)); slides.appendChild(sdiv);
      const dot=document.createElement('div'); dot.className='dot'+(i===0?' active':''); dot.addEventListener('click',()=>{current=i; update(); reset();}); slideDots.appendChild(dot);
    }
    function update(){ slides.style.transform=`translateX(-${current*100}% )`; const ds=slideDots.children; for(let j=0;j<ds.length;j++){ ds[j].classList.toggle('active', j===current);} }
    function reset(){ if(sliderTimer) clearInterval(sliderTimer); sliderTimer=setInterval(()=>{ current=(current+1)%max; update(); },3000); }
    update(); reset();
  }

  /* ---------- Admin & Users ---------- */
  function initAdminPanel(){
    // Serverless sync controls
    const syncEndpointInput = document.getElementById('syncEndpointInput');
    const syncAppKeyInput   = document.getElementById('syncAppKeyInput');
    const saveSyncEndpointBtn = document.getElementById('saveSyncEndpointBtn');
    const testPushBtn = document.getElementById('testPushBtn');
    if(saveSyncEndpointBtn) saveSyncEndpointBtn.addEventListener('click', ()=>{
      const saved = JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
      if(syncEndpointInput) saved.syncEndpoint = (syncEndpointInput.value||'').trim();
      if(syncAppKeyInput)   saved.syncAppKey   = (syncAppKeyInput.value||'').trim();
      localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved));
      toast('Endpoint saved');
    });
    if(testPushBtn) testPushBtn.addEventListener('click', async ()=>{
      const ok = await pushToGitHub(buildProductsPayload());
      toast(ok ? 'Test push OK ‚úì' : 'Test push failed');
    });

    adminOpenBtn.addEventListener('click',()=>{
      const saved = JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
      if(adminLoggedIn || (currentUser && saved.adminEmail && currentUser.toLowerCase()===saved.adminEmail.toLowerCase())){
        adminPanel.classList.add('active'); renderUsersList(); updateProductsUI(); toast('Admin access granted.');
      } else { adminGateModal.classList.add('show'); }
    });
    if(closeAdmin) closeAdmin.addEventListener('click',()=>adminPanel.classList.remove('active'));
    gateLoginBtn.addEventListener('click',()=>{
      const saved = JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
      const e = (gateEmail.value||'').trim().toLowerCase();
      const p = (gatePass.value||'').trim();
      if(e===(saved.adminEmail||'').toLowerCase() && p===(saved.adminPass||'')){
        currentUser=e; adminLoggedIn=true; Storage.set(LS_KEYS.CURRENT_USER,currentUser); Storage.set(LS_KEYS.ADMIN_LOGGED_IN,'true');
        adminGateModal.classList.remove('show'); refreshUserUI(); refreshAdminUI(); updateProductsUI(); adminPanel.classList.add('active'); toast('Welcome, Admin!');
      } else { alert('Invalid admin credentials'); }
    });

    if(logoSetBtn) logoSetBtn.addEventListener('click',uploadLogo);
    if(addProductBtn) addProductBtn.addEventListener('click',uploadProduct);
    if(clearProductsBtn) clearProductsBtn.addEventListener('click',clearAllProducts);
    if(saveSentencesBtn) saveSentencesBtn.addEventListener('click',saveSentences);
    if(setCurrencyBtn) setCurrencyBtn.addEventListener('click',saveCurrency);
    if(saveContactsBtn) saveContactsBtn.addEventListener('click',saveContacts);
    if(openContactsBtn) openContactsBtn.addEventListener('click',openContacts);
    if(openShare) openShare.addEventListener('click',()=>shareModal.classList.add('show'));
    if(savePublicLinkBtn) savePublicLinkBtn.addEventListener('click',savePublicLink);

    const ex = document.getElementById('exportJsonBtn');
    if(ex) ex.addEventListener('click', exportProductsJson);
    const importJsonBtn = document.getElementById('importJsonBtn');
    const uploadJsonInput = document.getElementById('uploadJsonInput');
    if(importJsonBtn) importJsonBtn.addEventListener('click', ()=> uploadJsonInput && uploadJsonInput.click());
    if(uploadJsonInput) uploadJsonInput.addEventListener('change', handleImportProductsJson);

    const cWa=document.getElementById('contactWhatsapp');
    const cMs=document.getElementById('contactMessenger');
    const sWa=document.getElementById('shareWhatsapp');
    const sMs=document.getElementById('shareMessenger');
    const cp=document.getElementById('copyLinkBtn');
    if(cWa) cWa.addEventListener('click',()=>{ if(whatsappLink) window.open(whatsappLink,'_blank');});
    if(cMs) cMs.addEventListener('click',()=>{ if(messengerLink) window.open(messengerLink,'_blank');});
    if(sWa) sWa.addEventListener('click',()=>{ const url=publicLink||window.location.href; window.open('https://wa.me/?text='+encodeURIComponent(url),'_blank');});
    if(sMs) sMs.addEventListener('click',()=>{ const url=publicLink||window.location.href; window.open('https://m.me/?link='+encodeURIComponent(url),'_blank');});
    if(cp)  cp.addEventListener('click',()=>{ const url=publicLink||window.location.href; copyToClipboard(url);});
  }
  function refreshAdminUI(){
    try{ document.querySelectorAll('.admin-only').forEach(el=>{ el.style.display = adminLoggedIn ? '' : 'none'; }); if(adminLoggedIn){ renderUsersList(); updateProductsUI(); } }catch(e){}
  }
  async function uploadProduct(){
    try{
      const name=(productName && productName.value||'').trim();
      const price=(productPrice && productPrice.value||'').trim();
      const desc=(productDesc && productDesc.value||'').trim();
      const file= productImageInput && productImageInput.files && productImageInput.files[0];
      if(!name || !price){ alert('Name & price required'); return; }
      const image = await readFileToDataURL(file);
      const id = Date.now();
      const item={ id, name, price, desc, image: image || (DEFAULT_PRODUCTS[0] && DEFAULT_PRODUCTS[0].image) || '' };
      products.push(item); saveProducts();
      if(productImageInput) productImageInput.value=''; if(productName) productName.value=''; if(productPrice) productPrice.value=''; if(productDesc) productDesc.value='';
      toast('Product added ‚úì');
    }catch(e){ alert('Upload failed'); }
  }
  function saveProducts(){ try{ localStorage.setItem(LS_KEYS.PRODUCTS, JSON.stringify(products)); }catch(_){ } updateProductsUI(); }
  function readFileToDataURL(file){ return new Promise((resolve,reject)=>{ if(!file){ resolve(''); return; } const reader=new FileReader(); reader.onload=e=>resolve(e.target.result); reader.onerror=reject; reader.readAsDataURL(file); }); }
  function editProduct(id){
    if(!adminLoggedIn){ alert('Admin only'); return; }
    const idx = products.findIndex(p=>p.id===id); if(idx===-1){ alert('Not found'); return; }
    const p = products[idx];
    const nn = prompt('Edit name:', p.name); if(nn===null) return;
    const np = prompt('Edit price:', p.price); if(np===null) return;
    const nd = prompt('Edit description:', p.desc||''); if(nd===null) return;
    products[idx] = {...p, name: (nn||p.name).trim(), price: (np||p.price).trim(), desc: nd};
    saveProducts(); toast('Product updated ‚úì');
  }
  function deleteProduct(id){
    if(!adminLoggedIn){ alert('Admin only'); return; }
    if(!confirm('Delete this product?')) return;
    products = products.filter(p=>p.id!==id);
    saveProducts(); toast('Product deleted ‚úì');
  }

  /* ---------- Users / Auth ---------- */
  function signupUser(){
    const email=(userEmail.value||'').trim().toLowerCase();
    const pass=(userPass.value||'').trim();
    if(!email||!pass){ alert('Enter email & password'); return; }
    const remember = document.getElementById('rememberMeToggle') ? document.getElementById('rememberMeToggle').checked : true;
    currentUser=email;
    if(remember){
      Storage.set(LS_KEYS.CURRENT_USER,currentUser);
      Storage.set(LS_KEYS.REMEMBER_USER,'1');
    }else{
      Storage.set(LS_KEYS.REMEMBER_USER,'0');
      Storage.remove(LS_KEYS.CURRENT_USER);
    }
    alert('Account created and logged in'); refreshUserUI(); try{ if(currentUser){ if(!Array.isArray(users)) users=[]; const low=String(currentUser).toLowerCase(); if(!users.includes(low)) users.push(low); saveUsers(); renderUsersList(); } }catch(_){}
    userModal.classList.remove('show');
  }
  function loginUser(){
    const email=(userEmail.value||'').trim().toLowerCase();
    const pass=(userPass.value||'').trim();
    if(!email||!pass){ alert('Enter email & password'); return; }
    const remember = document.getElementById('rememberMeToggle') ? document.getElementById('rememberMeToggle').checked : true;
    currentUser=email;
    if(remember){
      Storage.set(LS_KEYS.CURRENT_USER,currentUser);
      Storage.set(LS_KEYS.REMEMBER_USER,'1');
    }else{
      Storage.set(LS_KEYS.REMEMBER_USER,'0');
      Storage.remove(LS_KEYS.CURRENT_USER);
    }
    alert('Logged in'); refreshUserUI(); try{ if(currentUser){ if(!Array.isArray(users)) users=[]; const low=String(currentUser).toLowerCase(); if(!users.includes(low)) users.push(low); saveUsers(); renderUsersList(); } }catch(_){}
    userModal.classList.remove('show');
  }
  function logoutUser(){
    try{
      Storage.remove(LS_KEYS.CURRENT_USER);
      Storage.remove(LS_KEYS.ADMIN_LOGGED_IN);
      Storage.set(LS_KEYS.REMEMBER_USER,'0');
      Storage.set(LS_KEYS.REMEMBER_ADMIN,'0');
      currentUser=null; adminLoggedIn=false;
      alert('Logged out');
      refreshUserUI(); refreshAdminUI();
      adminPanel.classList.remove('active');
    }catch(e){ alert('Logout error'); }
  }
  if(userAuthBtn){ userAuthBtn.addEventListener('click', ()=>{ if(!currentUser) userModal.classList.add('show');}); }
  if(userLogoutBtn) userLogoutBtn.addEventListener('click', logoutUser);
  function initUserSystem(){
    loadUsers();
    try{
      const remember = Storage.get(LS_KEYS.CURRENT_USER, null);
      if(remember){ currentUser = remember; }
      const saved = JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
      if(Storage.get(LS_KEYS.ADMIN_LOGGED_IN)==='true' || (currentUser && saved.adminEmail && currentUser.toLowerCase()===String(saved.adminEmail).toLowerCase())){
        adminLoggedIn = true;
      }
    }catch(e){}
    refreshUserUI(); refreshAdminUI();
  }
  function loadUsers(){ try{ users = JSON.parse(localStorage.getItem(LS_KEYS.USERS)||'[]'); if(!Array.isArray(users)) users=[]; } catch(_){ users = []; } }
  function saveUsers(){ try{ const uniq = Array.from(new Set((users||[]).map(e => String(e||'').trim().toLowerCase()).filter(Boolean))); localStorage.setItem(LS_KEYS.USERS, JSON.stringify(uniq)); users = uniq; }catch(_){} }
  function renderUsersList(){
    const box = document.getElementById('usersList'); if(!box) return;
    const list = Array.isArray(users) ? users.slice().sort() : []; const gmails = list.filter(u=>/@gmail\.com$/i.test(u));
    if(!list.length){ box.innerHTML = '<p class="muted">No users yet</p>'; return; }
    box.innerHTML = '<div><strong>Total: '+list.length+'</strong></div>'
      + '<ul style="margin:8px 0 0 18px">' + list.map(u=>'<li>'+u+'</li>').join('') + '</ul>'
      + '<div class="muted" style="margin-top:8px">Gmail ('+gmails.length+'): '+(gmails.join(', ')||'‚Äî')+'</div>';
  }

  /* ---------- Misc admin actions ---------- */
  function uploadLogo(){ const file=logoInput && logoInput.files && logoInput.files[0]; if(!file){ alert('Choose a file'); return; } const reader=new FileReader(); reader.onload=e=>{ const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}'); saved.logo=e.target.result; localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved)); siteLogo.src=heroLogo.src=saved.logo; toast('Logo updated'); }; reader.readAsDataURL(file); }
  function clearAllProducts(){ localStorage.removeItem(LS_KEYS.PRODUCTS); products=DEFAULT_PRODUCTS.slice(); updateProductsUI(); toast('Products cleared'); }
  function saveSentences(){ const v=(sentencesInput&&sentencesInput.value||'').trim(); const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}'); saved.sentences=v; localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved)); rotatingSentences=v? v.split(',').map(s=>s.trim()).filter(Boolean):rotatingSentences; toast('Saved sentences'); }
  function saveCurrency(){ const v=(currencyInput&&currencyInput.value||'').trim(); if(!v){ alert('Enter symbol'); return;} const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}'); saved.currency=v; localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved)); currencySymbol=v; updateProductsUI(); toast('Currency set'); }
  function saveContacts(){ const cc=(whatsappCountry&&whatsappCountry.value)||''; const nn=(whatsappNumber&&whatsappNumber.value)||''; const ms=(messengerInput&&messengerInput.value)||''; const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}'); saved.whatsapp= cc&&nn? (cc+nn):''; saved.messenger=ms; localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved)); whatsappLink=saved.whatsapp; messengerLink=saved.messenger; toast('Contacts saved'); }
  function openContacts(){ if(whatsappLink) window.open(whatsappLink,'_blank'); else if(messengerLink) window.open(messengerLink,'_blank'); else alert('No contact set'); }
  function savePublicLink(){ const v=(publicLinkInput&&publicLinkInput.value||'').trim(); const saved=JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}'); saved.publicLink=v; localStorage.setItem(LS_KEYS.SITE, JSON.stringify(saved)); publicLink=v; toast('Public link saved'); }
  function exportProductsJson(){
    try{
      const saved = JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
      const payload = { settings: saved, products: products };
      const jsonStr = JSON.stringify(payload,null,2);
      const blob = new Blob([jsonStr], {type:'application/json'});
      const url = (window.URL||window.webkitURL).createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='products.json'; document.body.appendChild(a); a.click();
      setTimeout(()=>{ (window.URL||window.webkitURL).revokeObjectURL(url); a.remove(); }, 0);
      toast('Download started');
    }catch(e){ alert('Export failed'); }
  }
  function handleImportProductsJson(evt){
    const f = evt && evt.target && evt.target.files && evt.target.files[0];
    if(!f){ alert('No file'); return; }
    const reader = new FileReader();
    reader.onload = (e)=>{
      try{
        const obj = JSON.parse(e.target.result);
        const arr = Array.isArray(obj)? obj : (obj && obj.products) || [];
        if(arr.length){ products = arr; localStorage.setItem(LS_KEYS.PRODUCTS, JSON.stringify(products)); updateProductsUI(); toast('Imported products'); }
        if(obj && obj.settings) importSettingsFromRemote(obj.settings);
      }catch(err){ alert('Invalid JSON'); }
    };
    reader.readAsText(f);
  }
  function copyToClipboard(t){ try{ navigator.clipboard && navigator.clipboard.writeText ? navigator.clipboard.writeText(t) : document.execCommand('copy'); toast('Copied ‚úì'); }catch(_){ prompt('Copy', t); } }

  
/* ---------- Serverless Push (GitHub auto-update) ---------- */
async function pushToGitHub(payload){
  try{
    const saved = JSON.parse(localStorage.getItem(LS_KEYS.SITE)||'{}');
    const endpoint = (document.getElementById('syncEndpointInput')?.value || saved.syncEndpoint || '').trim();
    if(!endpoint) return false;
    const appKey = (document.getElementById('syncAppKeyInput')?.value || saved.syncAppKey || '').trim();
    const res = await fetch(endpoint, {
      method:'POST',
      headers:{ 'Content-Type':'application/json', ...(appKey? {'X-App-Key': appKey} : {}) },
      body: JSON.stringify(payload)
    });
    return res.ok;
  }catch(e){ console.warn('pushToGitHub error', e); return false; }
}

/* ---------- Text rotate & Toast ---------- */
  function autoRotateText(){ let idx=0; setInterval(()=>{ rotatingText.textContent=rotatingSentences[idx]; idx=(idx+1)%rotatingSentences.length; },2800); }
  function toast(msg){ const el=document.getElementById('adminAlert'); if(!el) return; el.textContent=msg; el.classList.remove('hidden'); clearTimeout(toast._t); toast._t=setTimeout(()=>el.classList.add('hidden'),2200); }
  
async function persistJsonChange(reason){
  try{
    const ok = await pushToGitHub(buildProductsPayload());
    if(ok) { try{ toast('Synced to GitHub ‚úì'); }catch(_){}} 
  }catch(_){}
}
</script>
</body>
</html>
